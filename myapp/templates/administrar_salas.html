{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Administrar Salas - CineDot</title>
  <link rel="stylesheet" href="{% static 'styles/administrar_salas.css' %}">
</head>
<body>
  <!-- Loader animado -->
  <div class="loader-overlay" id="loader">
    <div class="loader-content">
      <div class="film-strip">
        <div class="film-hole"></div>
        <div class="film-hole"></div>
        <div class="film-hole"></div>
      </div>
      <p class="loader-text">Cargando salas...</p>
    </div>
  </div>

  <!-- Contenedor principal -->
  <div class="cine-container">
    <!-- Header con efecto glassmorphism -->
    <div class="header-admin">
      <h1 class="admin-title">
        <span class="title-icon">üé¨</span>
        Administrar Salas
        <div class="title-underline"></div>
      </h1>
      <div class="admin-buttons">
        <a href="{% url 'peliculas' %}" class="btn-green">
          <span class="btn-icon">üéûÔ∏è</span>
          Pel√≠culas
        </a>
        <a href="{% url 'index' %}" class="btn-green">
          <span class="btn-icon">üè†</span>
          Inicio
        </a>
      </div>
    </div>

    <!-- Selector de Fecha con animaci√≥n -->
    <div class="section-card fade-in">
      <form method="GET" class="form-group">
        <label for="fecha" class="form-label">
          <span class="label-icon">üìÖ</span>
          Fecha de la Funci√≥n
        </label>
        <div class="date-selector">
          {% for dia in fechas_disponibles %}
          <button type="submit" name="fecha" value="{{ dia.fecha|date:'Y-m-d' }}" 
                  class="date-btn {% if dia.fecha == fecha_seleccionada %}active{% endif %} {% if dia.es_hoy %}today{% endif %}">
            <span class="day-name">{{ dia.nombre }}</span>
            <span class="day-date">{{ dia.formato }}</span>
            {% if dia.es_hoy %}
            <span class="today-badge">Hoy</span>
            {% endif %}
          </button>
          {% endfor %}
        </div>
      </form>
    </div>

    <!-- Select de pel√≠culas con animaci√≥n -->
    <div class="section-card fade-in" style="animation-delay: 0.1s;">
      <form method="GET" class="form-group">
        <input type="hidden" name="fecha" value="{{ fecha_seleccionada|date:'Y-m-d' }}">
        <label for="pelicula" class="form-label">
          <span class="label-icon">üé•</span>
          Pel√≠cula en Cartelera
        </label>
        <div class="select-wrapper">
          <select name="pelicula" id="pelicula" class="custom-select" onchange="this.form.submit()">
            <option value="">-- Selecciona una pel√≠cula --</option>
            {% for p in peliculas %}
            <option value="{{ p.id }}" {% if pelicula and p.id == pelicula.id %}selected{% endif %}>
              {{ p.nombre }}
            </option>
            {% endfor %}
          </select>
        </div>
      </form>
    </div>

    <!-- Select de horario y sala con animaci√≥n -->
    {% if pelicula %}
    <div class="section-card fade-in" style="animation-delay: 0.2s;">
      <form method="GET" class="form-group">
        <input type="hidden" name="pelicula" value="{{ pelicula.id }}">
        <input type="hidden" name="fecha" value="{{ fecha_seleccionada|date:'Y-m-d' }}">
        <label for="combo" class="form-label">
          <span class="label-icon">üé≠</span>
          Horario y Sala
        </label>
        <div class="select-wrapper">
          <select name="combo" id="combo" class="custom-select" onchange="this.form.submit()">
            <option value="">-- Selecciona horario y sala --</option>
            {% for c in combinaciones %}
            <option value="{{ c }}" {% if c == combo_actual %}selected{% endif %}>{{ c }}</option>
            {% endfor %}
          </select>
        </div>
      </form>
    </div>
    {% endif %}

    <!-- Cuadr√≠cula de asientos con animaci√≥n -->
    {% if combo_actual %}
    <div class="section-card fade-in" style="animation-delay: 0.3s;">
      <!-- Info de la funci√≥n -->
      <div class="function-info">
        <div class="info-card">
          <span class="info-icon">üé¨</span>
          <span class="info-text">{{ pelicula.nombre }}</span>
        </div>
        <div class="info-card">
          <span class="info-icon">üìÖ</span>
          <span class="info-text">{{ fecha_seleccionada|date:"d/m/Y" }}</span>
        </div>
        <div class="info-card">
          <span class="info-icon">üé≠</span>
          <span class="info-text">{{ combo_actual }}</span>
        </div>
      </div>

      <!-- Pantalla del cine -->
      <div class="screen-container">
        <div class="screen">
          <span class="screen-text">PANTALLA</span>
          <div class="screen-glow"></div>
        </div>
      </div>

      <!-- Leyenda -->
      <div class="legend">
        <div class="legend-item">
          <div class="seat-demo available"></div>
          <span>Disponible</span>
        </div>
        <div class="legend-item">
          <div class="seat-demo reserved"></div>
          <span>Ocupado</span>
        </div>
        <div class="legend-item">
          <div class="seat-demo selected"></div>
          <span>Seleccionado</span>
        </div>
      </div>

      <!-- Asientos (5 filas x 8 columnas = 40 asientos) -->
      <div class="seats-container">
        <div class="seats-grid">
          {% for fila in "ABCDE" %}
          <div class="seat-row" style="animation-delay: {{ forloop.counter0|add:'0.05' }}s;">
            <span class="row-letter">{{ fila }}</span>
            {% for numero in "12345678" %}
            {% with asiento=fila|add:numero %}
            <div class="seat {% if asiento in asientos_ocupados %}reserved clickable{% else %}available{% endif %}" 
                 data-seat="{{ asiento }}"
                 style="animation-delay: {{ forloop.counter0|add:'0.02' }}s;">
              <span class="seat-number">{{ numero }}</span>
              <div class="seat-shine"></div>
            </div>
            {% endwith %}
            {% endfor %}
          </div>
          {% endfor %}
        </div>
      </div>

      <!-- Contador de asientos -->
      <div class="stats-container">
        <div class="stat-card">
          <span class="stat-number">{{ asientos_ocupados|length }}</span>
          <span class="stat-label">Ocupados</span>
        </div>
        <div class="stat-card">
          <span class="stat-number" id="available-count">0</span>
          <span class="stat-label">Disponibles</span>
        </div>
      </div>

      <!-- Botones de acci√≥n -->
      <div class="action-buttons">
        <button class="btn-action btn-reset" id="btn-restablecer">
          <span class="btn-icon">üîÑ</span>
          <span class="btn-text">Restablecer Todos</span>
          <div class="btn-ripple"></div>
        </button>
        <button class="btn-action btn-delete" id="btn-eliminar" style="display:none;">
          <span class="btn-icon">üóëÔ∏è</span>
          <span class="btn-text">Eliminar <span id="asiento-label"></span></span>
          <div class="btn-ripple"></div>
        </button>
      </div>
    </div>
    {% endif %}
  </div>

  <!-- Toast de notificaciones -->
  <div class="toast" id="toast">
    <span class="toast-icon">‚úì</span>
    <span class="toast-message"></span>
  </div>

  <!-- JavaScript externo -->
  <script>
    // Pasar el CSRF token al JavaScript
    window.CSRF_TOKEN = '{{ csrf_token }}';
    
    // **CR√çTICO**: Ocultar loader como fallback si el JS externo falla
    window.addEventListener('load', function() {
      setTimeout(function() {
        const loader = document.getElementById('loader');
        if (loader) {
          loader.classList.add('hidden');
        }
      }, 1000);
    });
  </script>
  <script src="{% static 'js/adminsalas.js' %}"></script>
</body>
</html>