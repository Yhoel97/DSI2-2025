{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>üìä Dashboard Administrativo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Estilos -->
  <link rel="stylesheet" href="{% static 'styles/dashboard.css' %}">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
  <!-- Header -->
  <header class="p-3 text-center">
    <h2><i class="fas fa-chart-line me-2 text-success"></i> Dashboard Administrativo</h2>
    <!-- Botones de navegaci√≥n -->
    <div class="mb-3 d-flex gap-2 flex-wrap justify-content-center nav-buttons">
        <a href="{% url 'index' %}" class="btn-nav"><i class="fas fa-home"></i> Inicio</a>
        <a href="{% url 'administrar_salas' %}" class="btn-nav"><i class="fas fa-door-open"></i> Salas</a>
        <a href="{% url 'administrar_funciones' %}" class="btn-nav"><i class="fas fa-calendar-alt"></i> Funciones</a>
        <a href="{% url 'reportes_admin' %}" class="btn-nav"><i class="fas fa-chart-bar"></i> Reportes</a>
        <a href="{% url 'dashboard_admin' %}" class="btn-nav"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
    </div>
  </header>

  <div class="container mt-4">
    <!-- Totales -->
    <div class="row mb-4">
      <div class="col-md-6">
        <div class="card shadow-sm text-center p-3">
          <h5>Total de Boletos</h5>
          <h2 class="text-primary">{{ resumen_general.total_boletos|default:0 }}</h2>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card shadow-sm text-center p-3">
          <h5>Total de Ventas</h5>
          <h2 class="text-success">${{ resumen_general.total_ventas|floatformat:2 }}</h2>
        </div>
      </div>
    </div>

    <!-- Gr√°ficos lado a lado -->
    <div class="row">
      <div class="col-md-6 mb-4">
        <div class="card shadow-sm p-3">
          <h5 class="text-center">üé¨ Top 10 Pel√≠culas m√°s vendidas</h5>
          <canvas id="chartPeliculas"></canvas>
        </div>
      </div>
      <div class="col-md-6 mb-4">
        <div class="card shadow-sm p-3">
          <h5 class="text-center">üéüÔ∏è Boletos por Formato</h5>
          <canvas id="chartFormatos"></canvas>
        </div>
      </div>
    </div>

    <!-- Tabla: Cantidad por formato -->
    <div class="card shadow-sm p-3 mb-4">
      <h5><i class="fas fa-layer-group me-2 text-info"></i> Cantidad desglosada por Formato</h5>
      <table class="table table-bordered text-center table-modern">
        <thead>
          <tr>
            <th>Formato</th>
            <th>Boletos</th>
            <th>Total ($)</th>
          </tr>
        </thead>
        <tbody>
          {% for f in formatos %}
          <tr class="row-color-{{ forloop.counter0 }}">
            <td>{{ f.formato }}</td>
            <td>{{ f.total_boletos }}</td>
            <td>${{ f.total_venta|floatformat:2 }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Tabla: Ventas por pel√≠cula -->
    <div class="card shadow-sm p-3 mb-4">
      <h5><i class="fas fa-film me-2 text-warning"></i> Ventas por Pel√≠cula</h5>
      <table class="table table-bordered text-center table-modern">
        <thead>
          <tr>
            <th>Pel√≠cula</th>
            <th>Boletos</th>
            <th>Total ($)</th>
          </tr>
        </thead>
        <tbody>
          {% for p in top_peliculas %}
          <tr class="row-color-{{ forloop.counter0 }}">
            <td>{{ p.pelicula__nombre }}</td>
            <td>{{ p.total_boletos }}</td>
            <td>${{ p.total_venta|floatformat:2 }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Pasamos los datos -->
  <script>
    const topPeliculas = JSON.parse('{{ top_peliculas_json|escapejs }}');
    const formatos = JSON.parse('{{ formatos_json|escapejs }}');
  </script>
  <script src="{% static 'js/dashboard.js' %}"></script>
</body>
</html>