{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }} - CineDot</title>
    <link rel="stylesheet" href="{% static 'styles/login.css' %}">
    <link rel="stylesheet" href="{% static 'styles/registro.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container registro-container">
        <div class="left-section">
            <img src="{% static 'imagenes/cine.jpg' %}" alt="CineDot">
        </div>
        <div class="right-section">
            <h2><i class="fas fa-user-plus"></i> {{ title }}</h2>
            <p style="text-align: center; color: #666; margin-bottom: 20px;">
                Únete a CineDot y disfruta de la mejor experiencia cinematográfica
            </p>

            <!-- Mensajes de error generales -->
            {% if messages %}
                {% for message in messages %}
                    <div class="{% if message.tags == 'error' %}error-messages{% else %}success-message{% endif %}">
                        <i class="fas {% if message.tags == 'error' %}fa-exclamation-triangle{% else %}fa-check-circle{% endif %}"></i>
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}

            <!-- Errores no específicos de campo -->
            {% if form.non_field_errors %}
                <div class="error-messages">
                    <i class="fas fa-exclamation-triangle"></i>
                    {{ form.non_field_errors }}
                </div>
            {% endif %}

            <form method="POST" action="{% url 'registro' %}">
                {% csrf_token %}
                
                <!-- Username -->
                <div class="input-group">
                    <label for="{{ form.username.id_for_label }}">
                        <i class="fas fa-user"></i> {{ form.username.label }}
                    </label>
                    {{ form.username }}
                    {% if form.username.help_text %}
                        <div class="help-text">{{ form.username.help_text }}</div>
                    {% endif %}
                    {% if form.username.errors %}
                        <div class="field-errors">
                            {% for error in form.username.errors %}
                                <div><i class="fas fa-exclamation-circle"></i> {{ error }}</div>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Email -->
                <div class="input-group">
                    <label for="{{ form.email.id_for_label }}">
                        <i class="fas fa-envelope"></i> {{ form.email.label }}
                    </label>
                    {{ form.email }}
                    {% if form.email.help_text %}
                        <div class="help-text">{{ form.email.help_text }}</div>
                    {% endif %}
                    {% if form.email.errors %}
                        <div class="field-errors">
                            {% for error in form.email.errors %}
                                <div><i class="fas fa-exclamation-circle"></i> {{ error }}</div>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Nombre y Apellido en una fila -->
                <div class="form-row">
                    <div class="input-group">
                        <label for="{{ form.first_name.id_for_label }}">
                            <i class="fas fa-id-card"></i> {{ form.first_name.label }}
                        </label>
                        {{ form.first_name }}
                        {% if form.first_name.errors %}
                            <div class="field-errors">
                                {% for error in form.first_name.errors %}
                                    <div><i class="fas fa-exclamation-circle"></i> {{ error }}</div>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>

                    <div class="input-group">
                        <label for="{{ form.last_name.id_for_label }}">
                            <i class="fas fa-id-card"></i> {{ form.last_name.label }}
                        </label>
                        {{ form.last_name }}
                        {% if form.last_name.errors %}
                            <div class="field-errors">
                                {% for error in form.last_name.errors %}
                                    <div><i class="fas fa-exclamation-circle"></i> {{ error }}</div>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Contraseña -->
                <div class="input-group">
                    <label for="{{ form.password1.id_for_label }}">
                        <i class="fas fa-lock"></i> {{ form.password1.label }}
                    </label>
                    {{ form.password1 }}
                    {% if form.password1.help_text %}
                        <div class="help-text">{{ form.password1.help_text }}</div>
                    {% endif %}
                    {% if form.password1.errors %}
                        <div class="field-errors">
                            {% for error in form.password1.errors %}
                                <div><i class="fas fa-exclamation-circle"></i> {{ error }}</div>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Confirmar Contraseña -->
                <div class="input-group">
                    <label for="{{ form.password2.id_for_label }}">
                        <i class="fas fa-lock"></i> {{ form.password2.label }}
                    </label>
                    {{ form.password2 }}
                    {% if form.password2.help_text %}
                        <div class="help-text">{{ form.password2.help_text }}</div>
                    {% endif %}
                    {% if form.password2.errors %}
                        <div class="field-errors">
                            {% for error in form.password2.errors %}
                                <div><i class="fas fa-exclamation-circle"></i> {{ error }}</div>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Botón de registro -->
                <button type="submit" class="btn-primary">
                    <i class="fas fa-user-plus"></i> Crear Cuenta
                </button>

                <!-- Enlace al login -->
                <div class="register-link">
                    <p>¿Ya tienes una cuenta? <a href="{% url 'login' %}">Inicia Sesión aquí</a></p>
                    <p><a href="{% url 'index' %}">← Volver al inicio</a></p>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Mejorar la experiencia de usuario
        document.addEventListener('DOMContentLoaded', function() {
            // Auto-ocultar mensajes después de 5 segundos
            const messages = document.querySelectorAll('.success-message, .error-messages');
            messages.forEach(message => {
                setTimeout(() => {
                    message.style.transition = 'opacity 0.5s';
                    message.style.opacity = '0';
                    setTimeout(() => {
                        message.remove();
                    }, 500);
                }, 5000);
            });

            // Validación en tiempo real del email
            const emailField = document.getElementById('{{ form.email.id_for_label }}');
            if (emailField) {
                emailField.addEventListener('blur', function() {
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (this.value && !emailRegex.test(this.value)) {
                        this.style.borderColor = '#dc3545';
                    } else {
                        this.style.borderColor = '#ddd';
                    }
                });
            }

            // Indicador de fortaleza de contraseña
            const passwordField = document.getElementById('{{ form.password1.id_for_label }}');
            if (passwordField) {
                passwordField.addEventListener('input', function() {
                    const password = this.value;
                    let strength = 0;
                    
                    if (password.length >= 8) strength++;
                    if (/[a-zA-Z]/.test(password)) strength++;
                    if (/\d/.test(password)) strength++;
                    if (/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\?]/.test(password)) strength++;
                    
                    // Cambiar color del borde según la fortaleza
                    if (strength < 2) {
                        this.style.borderColor = '#dc3545';
                    } else if (strength < 3) {
                        this.style.borderColor = '#ffc107';
                    } else {
                        this.style.borderColor = '#28a745';
                    }
                });
            }
        });
    </script>
</body>
</html>